{
  "hash": "dc3a115e438a3aafcd4477ede4a545b6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Correlations between plant species and DNA barcode availability\"\nformat: html\nglobal: true\nparams:\n  today: '!r format(Sys.Date(), \"%Y%m%d\")'\n---\n\n\n\n\nThis notebook pulls in data from various sources and makes plots to compare plants species per family to availability of DNA barcodes.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## First check for the required packages, install if needed, and load the libraries.\nif (!requireNamespace(\"BiocManager\", quietly = TRUE))\n    install.packages(\"BiocManager\")\n\nBiocManager::install(\"sangerseqR\")\nremotes::install_github(\"ropensci/bold\")\nremotes::install_github(\"ropensci/taxize\")\n\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(maps, ggplot2, dplyr, countrycode, rgbif, data.table, raster, mapproj, sf, glue)\n```\n:::\n\n\n\n\n## SI Appendix Figure 2A-D: Read in files and summarize for panels A-B.\n\n#### First we read in the data and make some quick plots.\n\nThe `combtab` data corresponds to the Supplemental Dataset S1 from the publication.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombtab <- read.csv(\"../data/BoldPhyla_to_Families_combtab_v4.csv\")\nhead(combtab, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  X.1 X   processid               institution_storing phylum_taxID\n1   1 1   API120-12 Sri Ramaswamy Memorial University           12\n2   2 2 CANGI002-17      Museu Paraense Emilio Goeldi           12\n    phylum_name class_taxID    class_name order_taxID order_name family_taxID\n1 Magnoliophyta          41 Magnoliopsida      121216   Lamiales       148533\n2 Magnoliophyta          41 Magnoliopsida      121216   Lamiales       148533\n  family_name subfamily_taxID subfamily_name genus_taxID  genus_name\n1 Acanthaceae              NA                     415894 Peristrophe\n2 Acanthaceae          264310   Acanthoideae      148534     Ruellia\n  species_taxID             species_name subspecies_taxID subspecies_name\n1        494465 Peristrophe bicalyculata               NA                \n2        632816          Ruellia inflata               NA                \n  collectiondate_start collectiondate_end lat lon coord_source coord_accuracy\n1                   NA                 NA  NA  NA                          NA\n2                   NA                 NA  NA  NA                          NA\n  elev country province_state region sector exactsite rbcL matK trnL ITS2\n1   NA                                                rbcL               \n2   NA  Brazil           Para                         rbcL matK       ITS\n           multi gb_rbcL gb_matK gb_trnL gb_ITS\n1        rbcL---                               \n2 rbcL-matK--ITS                               \n```\n\n\n:::\n\n```{.r .cell-code}\n# Round coordiantes to nearest 1 degree\ncombtab$lat <- as.numeric(as.character(combtab$lat))\ncombtab$lon <- as.numeric(as.character(combtab$lon))\n\n# Phylum rank\nbarplot(sort(table(combtab$phylum_name), decreasing=T), main = \"Most barcoded Phyla\")\n```\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Family rank\nhead(sort(table(combtab$family_name), decreasing=T), 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Fabaceae       Poaceae   Orchidaceae    Asteraceae      Rosaceae \n        17808         15624         14575         14410          6802 \n    Rubiaceae    Cyperaceae     Lamiaceae Euphorbiaceae     Ericaceae \n         6690          6214          5325          4863          4057 \n```\n\n\n:::\n\n```{.r .cell-code}\nbarplot(sort(table(combtab$family_name), decreasing=T), main = \"Most barcoded Families\")\n```\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n\n```{.r .cell-code}\nhead(table(combtab$family_name, combtab$multi), 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             \n              --trnL- -matK-- -matK-trnL- #NAME? rbcL--- rbcL---ITS rbcL--trnL-\n  Acanthaceae       2     130          10    626     192          6          25\n  Achariaceae       1      25           0      2     132          0           0\n             \n              rbcL--trnL-ITS rbcL-matK-- rbcL-matK--ITS rbcL-matK-trnL-\n  Acanthaceae              1         285             70              77\n  Achariaceae              0         136              6               1\n             \n              rbcL-matK-trnL-ITS\n  Acanthaceae                 16\n  Achariaceae                  1\n```\n\n\n:::\n\n```{.r .cell-code}\n# the most barcoded plant species in the world\nsort(table(combtab$species_name), decreasing=T)[1:5] # by specimens\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n                                          Bryum argenteum \n                        7495                          551 \n         Scorpidium cossonii Acanthorrhynchium papillatum \n                         354                          195 \n              Aneura pinguis \n                         195 \n```\n\n\n:::\n:::\n\n\n\n\n#### Plot family abundances in ITIS and compare with barcodes: this section gives us panels A and B of the figure\n\nThe `infam` data corresponds to the Supplemental Dataset S2 from the publication.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninfam <- read.csv(\"../data/allFamNames.csv\")\nITISfamcount <- sort(table(infam$family), decreasing=T)\n\n# Create a useful matrix for summarizing the BOLD counts with respect to ITIS matches\nfamcountmat <- matrix(0, nrow = length(ITISfamcount), ncol = 9)\ncolnames(famcountmat)<-c(\"rank\", \"ITISfamname\", \"ITISfamcount\", \"BOLDspecimencount\", \"BOLDspeccount\", \"trnLcount\", \"rbcLcount\", \"matKcount\", \"ITScount\")\n  famcountmat<-data.frame(famcountmat)\n  famcountmat[,1]<-seq(1,length(ITISfamcount))\n  famcountmat[,2]<-names(ITISfamcount)\n  famcountmat[,3]<-ITISfamcount\n\n# Make count of specimens by family \ncombtabfamilycount <- table(combtab$family_name)\nfamcountmat[,4] <- combtabfamilycount[match(famcountmat[,2], names(combtabfamilycount))]\n\n# Make count of species by family\ncombtabspeciescount <- tapply(combtab$species_name, combtab$family_name, function(x) length(unique(x)))\nfamcountmat[,5] <- combtabspeciescount[match(famcountmat[,2], names(combtabspeciescount))]\n\n# Make count of trnL by family\ncombtabtrnLcount <- tapply(combtab$trnL, combtab$family_name, function(x) length(which(x == \"trnL\")))\nfamcountmat[,6] <- combtabtrnLcount[match(famcountmat[,2], names(combtabtrnLcount))]\n  \n# Make count of rbcL by family\ncombtabrbcLcount <- tapply(combtab$rbcL, combtab$family_name, function(x) length(which(x==\"rbcL\")))\nfamcountmat[,7] <- combtabrbcLcount[match(famcountmat[,2], names(combtabrbcLcount))]\n  \n# Make count of matK by family\ncombtabmatKcount <- tapply(combtab$matK, combtab$family_name, function(x) length(which(x==\"matK\")))\nfamcountmat[,8] <- combtabmatKcount[match(famcountmat[,2], names(combtabmatKcount))]\n  \n# Make count of ITS by family\ncombtabITScount <- tapply(combtab$ITS2, combtab$family_name, function(x) length(which(x==\"ITS\")))\nfamcountmat[,9] <- combtabITScount[match(famcountmat[,2], names(combtabITScount))]\n\nwrite.csv(famcountmat, \"../data/DatasetS2_trnL_rbcL_matK_ITS.csv\")\n```\n:::\n\n\n\n\n#### Summarize the data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Number of taxa\nnrow(famcountmat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 730\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(famcountmat$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 51925\n```\n\n\n:::\n\n```{.r .cell-code}\nrange(famcountmat$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]    1 5061\n```\n\n\n:::\n\n```{.r .cell-code}\nquantile(famcountmat$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     0%     25%     50%     75%    100% \n   1.00    1.00    4.00   27.75 5061.00 \n```\n\n\n:::\n\n```{.r .cell-code}\nmedian(famcountmat$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n\n```{.r .cell-code}\n# Number of family names in ITIS with barcodes\nlength(which(is.na(famcountmat$BOLDspecimencount) == F))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 609\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(which(is.na(famcountmat$BOLDspecimencount) == F))/nrow(famcountmat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8342466\n```\n\n\n:::\n\n```{.r .cell-code}\n# Number of family names ITIS without barcodes\nlength(which(is.na(famcountmat$BOLDspecimencount)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 121\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(which(is.na(famcountmat$BOLDspecimencount)))/nrow(famcountmat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1657534\n```\n\n\n:::\n\n```{.r .cell-code}\n# Characterize the no-barcode families (i.e., \"nbc\" families)\nnbcfams <- famcountmat[which(is.na(famcountmat$BOLDspecimencount)),]\nnbcfams <- nbcfams[order(nbcfams$ITISfamcount),] # reorder by ITIS fam size\nhead(nbcfams, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank      ITISfamname ITISfamcount BOLDspecimencount BOLDspeccount\n469  469      Alzateaceae            1                NA            NA\n471  471 Ambuchananiaceae            1                NA            NA\n    trnLcount rbcLcount matKcount ITScount\n469        NA        NA        NA       NA\n471        NA        NA        NA       NA\n```\n\n\n:::\n\n```{.r .cell-code}\ntail(nbcfams, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank       ITISfamname ITISfamcount BOLDspecimencount BOLDspeccount\n124  124 Balantiopsidaceae           62                NA            NA\n45    45   Hydrophyllaceae          203                NA            NA\n    trnLcount rbcLcount matKcount ITScount\n124        NA        NA        NA       NA\n45         NA        NA        NA       NA\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(nbcfams[,3])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 823\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(nbcfams)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 121   9\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(sort(nbcfams$ITISfamname), 2) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Alzateaceae\"      \"Ambuchananiaceae\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrange(nbcfams$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]   1 203\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(nbcfams$ITISfamcount)\n```\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmedian(nbcfams$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfams[order(nbcfams[,3]),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank      ITISfamname ITISfamcount BOLDspecimencount BOLDspeccount\n469  469      Alzateaceae            1                NA            NA\n471  471 Ambuchananiaceae            1                NA            NA\n    trnLcount rbcLcount matKcount ITScount\n469        NA        NA        NA       NA\n471        NA        NA        NA       NA\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfams[which(nbcfams[,3] == 1),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank      ITISfamname ITISfamcount BOLDspecimencount BOLDspeccount\n469  469      Alzateaceae            1                NA            NA\n471  471 Ambuchananiaceae            1                NA            NA\n    trnLcount rbcLcount matKcount ITScount\n469        NA        NA        NA       NA\n471        NA        NA        NA       NA\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(nbcfams[which(nbcfams[,3] == 1),])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 68  9\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(nbcfams[which(nbcfams[,3] == 1),])/nrow(nbcfams)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.5619835\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfams[which(nbcfams[,3]<5),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank      ITISfamname ITISfamcount BOLDspecimencount BOLDspeccount\n469  469      Alzateaceae            1                NA            NA\n471  471 Ambuchananiaceae            1                NA            NA\n    trnLcount rbcLcount matKcount ITScount\n469        NA        NA        NA       NA\n471        NA        NA        NA       NA\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(nbcfams[which(nbcfams[,3]<5),])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 93  9\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(nbcfams[which(nbcfams[,3]<5),])/nrow(nbcfams)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.768595\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfams[which(nbcfams$ITISfamname == \"Heliophytaceae\"),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] rank              ITISfamname       ITISfamcount      BOLDspecimencount\n[5] BOLDspeccount     trnLcount         rbcLcount         matKcount        \n[9] ITScount         \n<0 rows> (or 0-length row.names)\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfams[which(nbcfams$ITISfamname == \"Calliergonaceae\"),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank     ITISfamname ITISfamcount BOLDspecimencount BOLDspeccount trnLcount\n203  203 Calliergonaceae           21                NA            NA        NA\n    rbcLcount matKcount ITScount\n203        NA        NA       NA\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Summarize families in BOLD not in ITIS\nboldfamnames <- unique(combtab$family_name)\nlength(boldfamnames) #651\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 651\n```\n\n\n:::\n\n```{.r .cell-code}\n# Families in BOLD not matched by ITIS\nnomatchnames <- boldfamnames[which(boldfamnames %in% famcountmat$ITISfamname == F)]\nnomatchnames <- nomatchnames[which(nomatchnames != \"\")]\nlength(nomatchnames) #42\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 42\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(nomatchnames)/length(boldfamnames) #0.06451613\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.06451613\n```\n\n\n:::\n\n```{.r .cell-code}\n# Counts of specimens in families in BOLD not matched by ITIS\ncombtab$family_name <- factor(combtab$family_name)\nhead(sort(table(droplevels(combtab[which(combtab$family_name %in% nomatchnames),]$family_name)), decreasing=T), 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nChenopodiaceae  Asphodelaceae \n           818            798 \n```\n\n\n:::\n\n```{.r .cell-code}\nsum(sort(table(droplevels(combtab[which(combtab$family_name %in% nomatchnames),]$family_name)), decreasing=T))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3898\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(sort(table(droplevels(combtab[which(combtab$family_name %in% nomatchnames),]$family_name)), decreasing=T))/nrow(combtab)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.01383899\n```\n\n\n:::\n\n```{.r .cell-code}\nmedian(sort(table(droplevels(combtab[which(combtab$family_name %in% nomatchnames),]$family_name)), decreasing=T))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 8\n```\n\n\n:::\n\n```{.r .cell-code}\n# Number of specimens not identified to family\nlength(which(combtab$family_name == \"\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n\n\n\n## SI Appendix Figure 2A-D: Plot panels A-B\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot family count by specimens: Panel A\nplotcorrs <- famcountmat[complete.cases(famcountmat[,3:4]),] \nsummary(lm(log(as.numeric(plotcorrs$BOLDspecimencount)) ~ log(as.numeric(plotcorrs$ITISfamcount))))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = log(as.numeric(plotcorrs$BOLDspecimencount)) ~ log(as.numeric(plotcorrs$ITISfamcount)))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.1891 -0.8690  0.1937  0.8946  4.4466 \n\nCoefficients:\n                                        Estimate Std. Error t value Pr(>|t|)\n(Intercept)                              2.36350    0.07568   31.23   <2e-16\nlog(as.numeric(plotcorrs$ITISfamcount))  0.82924    0.02606   31.82   <2e-16\n                                           \n(Intercept)                             ***\nlog(as.numeric(plotcorrs$ITISfamcount)) ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.301 on 607 degrees of freedom\nMultiple R-squared:  0.6251,\tAdjusted R-squared:  0.6245 \nF-statistic:  1012 on 1 and 607 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nplotcorrs_ggplot_BOLDspecimen_ITISfamily <- ggplot(\n  plotcorrs, aes(x=log(ITISfamcount), y=log(BOLDspecimencount))) + \n  geom_point(pch = 1) + \n  theme_classic() + \n  xlab(\"Log of ITIS family count\") + \n  ylab(\"Log of BOLD specimen count\") + \n  geom_abline(intercept = 0, slope = 1, color = \"black\", linewidth = 1, linetype = \"dashed\") + \n  geom_smooth(method = \"lm\", se=FALSE, linewidth=1, color = \"darkgreen\") +\n  scale_y_continuous(breaks = seq(0,9, by = 3)) + \n  scale_x_continuous(breaks = seq(0,9, by = 3))\nplotcorrs_ggplot_BOLDspecimen_ITISfamily\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#ggsave(\"plotcorrs_ggplot_BOLDspecimen_ITISfamily.pdf\", plotcorrs_ggplot_BOLDspecimen_ITISfamily, width = 10, height = 8, units = \"cm\")\n\t\t\n# Summary stats for panel A\nplotcorrs_summary <- plotcorrs %>% dplyr::summarize(sumspecimens = sum(BOLDspecimencount))\nplotcorrs_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  sumspecimens\n1       277770\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot family count by species: PANEL B\nplotcorrs_ggplot_BOLDspecies_ITISfamily <- ggplot(\n  plotcorrs, aes(x=log(ITISfamcount), y=log(BOLDspeccount))) + \n  geom_point(pch = 1) + \n  theme_classic() + \n  xlab(\"Log of ITIS family count\") + \n  ylab(\"Log of BOLD species count\") + \n  geom_abline(intercept = 0, slope = 1, color = \"black\", linewidth = 1, linetype = \"dashed\") + \n  geom_smooth(method = \"lm\", se=FALSE, linewidth=1, color = \"darkgreen\") +\n  scale_y_continuous(breaks = seq(0,9, by = 3)) + scale_x_continuous(breaks = seq(0,9, by = 3))\nplotcorrs_ggplot_BOLDspecies_ITISfamily \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#ggsave(\"plotcorrs_ggplot_BOLDspecies_ITISfamily.pdf\", plotcorrs_ggplot_BOLDspecies_ITISfamily, width = 10, height = 8, units = \"cm\")\n\t\t\n#summary stats for panel B\nplotcorrs_summary <- plotcorrs %>% summarize(sumspecies = sum(BOLDspeccount))\nplotcorrs_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  sumspecies\n1     101674\n```\n\n\n:::\n:::\n\n\n\n\n## SI Appendix Figure 2A-D: Read in files and summarize for panels C-D.\n\nNow read in the data from downloading all *trnL* P6 data from the European Nucleotide Archive at [EMBL-EBI](https://www.ebi.ac.uk/ena/browser/home). More details for the download can be found in the \"Building the datasets\" section of the Methods in the publication. This data corresponds to dataset S3 in the Supplement.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemblp6 <- read.csv(\"../data/Kartzinel_et_al_Dataset_S3_20240725.csv\")\nnrow(emblp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 157020\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(unique(emblp6$trnL.P6.sequence)) # number of unique sequences \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 21467\n```\n\n\n:::\n\n```{.r .cell-code}\n#levels(factor(emblp6$Family)) # uncomment and run to print out all the family names\nlength(unique(emblp6$Family))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 666\n```\n\n\n:::\n\n```{.r .cell-code}\n157020/5324 # fold difference between number in BOLD vs EMBL\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 29.49286\n```\n\n\n:::\n\n```{.r .cell-code}\nemblp6_nofamily <- subset(emblp6, Family == \"\")\n\n# Build the same kind of matrix as above\nfamcountmatp6 <- matrix(0, nrow = length(ITISfamcount), ncol = 5)\ncolnames(famcountmatp6) <- c(\"rank\", \"ITISfamname\", \"ITISfamcount\", \"p6seqcount\", \"p6speccount\")\nfamcountmatp6 <- data.frame(famcountmatp6)\nfamcountmatp6[,1] <- seq(1,length(ITISfamcount))\nfamcountmatp6[,2] <- names(ITISfamcount)\nfamcountmatp6[,3] <- ITISfamcount\nlength(unique(emblp6$Family))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 666\n```\n\n\n:::\n\n```{.r .cell-code}\n#unique(emblp6$family_name) # uncomment to print out all the family names\n\nwrite.csv(famcountmatp6, \"../data/DatasetS2_P6_additions.csv\")\n\n# Make count of specimens by family\nemblp6count <- table(emblp6$Family)\nfamcountmatp6[,4] <- emblp6count[match(famcountmatp6[,2], names(emblp6count))]\nlength(emblp6count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 666\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(emblp6count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 157020\n```\n\n\n:::\n\n```{.r .cell-code}\n# Make count of species by family\nemblp6speciescount <- tapply(emblp6$Species, emblp6$Family, function(x) length(unique(x)))\nfamcountmatp6[,5] <- emblp6speciescount[match(famcountmatp6[,2], names(emblp6speciescount))]\n```\n:::\n\n\n\n\n#### Summarize the data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Number of taxa\nnrow(famcountmatp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 730\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(famcountmatp6$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 51925\n```\n\n\n:::\n\n```{.r .cell-code}\nrange(famcountmatp6$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]    1 5061\n```\n\n\n:::\n\n```{.r .cell-code}\nquantile(famcountmatp6$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     0%     25%     50%     75%    100% \n   1.00    1.00    4.00   27.75 5061.00 \n```\n\n\n:::\n\n```{.r .cell-code}\nmedian(famcountmatp6$ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n\n```{.r .cell-code}\n# Number of family names in ITIS with barcodes\nlength(which(is.na(famcountmatp6$p6seqcount) == F))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 611\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(which(is.na(famcountmatp6$p6seqcount) == F))/nrow(famcountmatp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8369863\n```\n\n\n:::\n\n```{.r .cell-code}\n# Number of family names ITIS without barcodes\nlength(which(is.na(famcountmatp6$p6seqcount)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 119\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(which(is.na(famcountmatp6$p6seqcount)))/nrow(famcountmatp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1630137\n```\n\n\n:::\n\n```{.r .cell-code}\n# Characterize the no-barcode families\nnbcfamsp6 <- famcountmatp6[which(is.na(famcountmatp6$p6seqcount)),]\nnbcfamsp6 <- nbcfamsp6[order(nbcfamsp6$ITISfamcount),] # reorder by ITIS fam size\nhead(nbcfamsp6, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank   ITISfamname ITISfamcount p6seqcount p6speccount\n469  469   Alzateaceae            1         NA          NA\n472  472 Anarthriaceae            1         NA          NA\n```\n\n\n:::\n\n```{.r .cell-code}\ntail(nbcfamsp6, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank      ITISfamname ITISfamcount p6seqcount p6speccount\n129  129  Selaginellaceae           56         NA          NA\n15    15 Xanthorrhoeaceae          658         NA          NA\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(nbcfamsp6[,3])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1069\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(nbcfamsp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 119   5\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(sort(nbcfamsp6 $ITISfamname), 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Alzateaceae\"  \"Amphidiaceae\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrange(nbcfamsp6 $ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]   1 658\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(nbcfamsp6 $ITISfamcount)\n```\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmedian(nbcfamsp6 $ITISfamcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfamsp6[order(nbcfamsp6[,3]),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank   ITISfamname ITISfamcount p6seqcount p6speccount\n469  469   Alzateaceae            1         NA          NA\n472  472 Anarthriaceae            1         NA          NA\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfamsp6[which(nbcfamsp6[,3]==1),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank   ITISfamname ITISfamcount p6seqcount p6speccount\n469  469   Alzateaceae            1         NA          NA\n472  472 Anarthriaceae            1         NA          NA\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(nbcfamsp6[which(nbcfamsp6[,3]==1),])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 76  5\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(nbcfamsp6[which(nbcfamsp6[,3]==1),])/nrow(nbcfamsp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6386555\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfamsp6[which(nbcfamsp6[,3]<5),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    rank   ITISfamname ITISfamcount p6seqcount p6speccount\n469  469   Alzateaceae            1         NA          NA\n472  472 Anarthriaceae            1         NA          NA\n```\n\n\n:::\n\n```{.r .cell-code}\ndim(nbcfamsp6[which(nbcfamsp6[,3]<5),])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 100   5\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(nbcfamsp6[which(nbcfamsp6[,3]<5),])/nrow(nbcfamsp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8403361\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfamsp6[which(nbcfamsp6 $ITISfamname==\"Heliophytaceae\"),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] rank         ITISfamname  ITISfamcount p6seqcount   p6speccount \n<0 rows> (or 0-length row.names)\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(nbcfamsp6[which(nbcfamsp6 $ITISfamname==\"Calliergonaceae\"),], 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] rank         ITISfamname  ITISfamcount p6seqcount   p6speccount \n<0 rows> (or 0-length row.names)\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Summarize families in embl not in ITIS\np6famnames <- unique(emblp6$Family)\nlength(p6famnames)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 666\n```\n\n\n:::\n\n```{.r .cell-code}\n# Families in embl not matched by ITIS\nnomatchnamesp6 <- p6famnames[which(p6famnames %in% famcountmatp6$ITISfamname == F)]\nnomatchnamesp6 <- nomatchnamesp6[which(nomatchnamesp6 != \"\")]\nlength(nomatchnamesp6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 55\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(nomatchnamesp6)/length(p6famnames)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.08258258\n```\n\n\n:::\n\n```{.r .cell-code}\n# Counts of specimens in families in embl not matched by ITIS\nemblp6$family_name <- factor(emblp6$Family)\nhead(sort(table(droplevels(emblp6[which(emblp6 $family_name %in% nomatchnamesp6),]$family_name)), decreasing=T), 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Hyacinthaceae Chenopodiaceae \n           672            347 \n```\n\n\n:::\n\n```{.r .cell-code}\nsum(sort(table(droplevels(emblp6[which(emblp6 $family_name %in% nomatchnamesp6),]$family_name)), decreasing=T))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1809\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(sort(table(droplevels(emblp6[which(emblp6 $family_name %in% nomatchnamesp6),]$family_name)), decreasing=T))/nrow(combtab)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.006422455\n```\n\n\n:::\n\n```{.r .cell-code}\nmedian(sort(table(droplevels(combtab[which(combtab$family_name %in% nomatchnamesp6),]$family_name)), decreasing=T))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 8\n```\n\n\n:::\n\n```{.r .cell-code}\n# Number of specimens not identified to family\nlength(which(emblp6$family_name == \"\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n:::\n\n\n\n\n#### Write out the Supplemental Dataset S2\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_s2 <- merge(famcountmat, famcountmatp6, by=c(\"rank\",\"ITISfamname\",\"ITISfamcount\"))\nwrite.csv(ds_s2, glue(\"../data/Kartzinel_et_al_Dataset_S2_{params$today}.csv\"))\n```\n:::\n\n\n\n\n## SI Appendix Figure 2A-D: Plot panels C-D\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot correlations - family count by specimens: Panel C\nplotcorrs <- famcountmatp6[complete.cases(famcountmatp6[,3:4]),]\nplotcorrs_ggplot_family_sequences <- ggplot(\n  plotcorrs, aes(x=log(ITISfamcount), y=log(p6seqcount))) + \n  geom_point(pch = 1) + \n  theme_classic() + \n  xlab(\"Log of ITIS family count\") + \n  ylab(\"Log of trnL-P6 sequence count\") + \n  geom_abline(intercept = 0, slope = 1, color = \"black\", linewidth = 1, linetype = \"dashed\") + \n  geom_smooth(method = \"lm\", se=FALSE, linewidth=1, color = \"darkgreen\") +\n  scale_y_continuous(breaks = seq(0,9, by = 3)) + \n  scale_x_continuous(breaks = seq(0,9, by = 3))\nplotcorrs_ggplot_family_sequences\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#ggsave(\"plotcorrs_ggplot_family_sequences.pdf\", plotcorrs_ggplot_family_sequences, width = 10, height = 8, units = \"cm\")\n\n# Summarize for panel C\nplotcorrs_summary <- plotcorrs %>% dplyr::summarize(sumP6sequences = sum(p6seqcount))\nplotcorrs_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  sumP6sequences\n1         155211\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Family count by species: Panel D\nplotcorrs_ggplot_family_sequencespecies <- ggplot(\n  plotcorrs, aes(x=log(ITISfamcount), y=log(p6speccount))) + \n  geom_point(pch = 1) + \n  theme_classic() + \n  xlab(\"Log of ITIS family count\") + \n  ylab(\"Log of trnL-P6 species count\") + \n  geom_abline(intercept = 0, slope = 1, color = \"black\", linewidth = 1, linetype = \"dashed\") + \n  geom_smooth(method = \"lm\", se=FALSE, linewidth=1, color = \"darkgreen\")  +\n  scale_y_continuous(breaks = seq(0,9, by = 3)) + \n  scale_x_continuous(breaks = seq(0,9, by = 3))\nplotcorrs_ggplot_family_sequencespecies\t\t\t\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](taxonomic_coverage_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#ggsave(\"plotcorrs_ggplot_family_sequencespecies.pdf\", plotcorrs_ggplot_family_sequencespecies, width = 10, height = 8, units = \"cm\")\n\n# Summarize for panel D\nplotcorrs_summary <- plotcorrs %>% summarize(sump6speccount = sum(p6speccount))\nplotcorrs_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  sump6speccount\n1          69873\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}